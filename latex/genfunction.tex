% genfunction.tex
% Updated January 11, 2012

\chapter{Generating Functions}\label{ch:genfunction}

A standard topic of study in first-year calculus is the representation
of functions as infinite sums called power series; such a
representation has the form $F(x)=\sum_{n=0}^\infty a_nx^n$. Perhaps
surprisingly these power series can also serve as very powerful
enumerative tools. In a combinatorial setting, we consider such power
series of this type as another way of encoding the values of a
sequence $\{a_n:n\ge0\}$ indexed by the non-negative integers. The
strength of power series as an enumerative technique is that they can
be manipulated just like ordinary functions, i.e., they can be added,
subtracted and multiplied, and for our purposes, we generally will not
care if the power series converges, which anyone who might have found
all of the convergence tests studied in calculus daunting will likely
find reassuring. However, when we find it convenient to do so, we will
use the familiar techniques from calculus and differentiate or
integrate them term by term, and for those familiar series that do
converge, we will use their representations as functions to facilitate
manipulation of the series.

\section{Basic Notation and Terminology}\label{s:genfunction:intro}

With a sequence $\sigma=\{a_n:n\ge0\}$ of real numbers, we associate
a ``function''  $F(x)$ defined by 
\[
F(x)=\sum_{n=0}^\infty a_n x^n.
\]
The word ``function'' is put in quotes as we do not necessarily
care about substituting a value of $x$ and obtaining a specific
value for $F(x)$.  In other words, we consider $F(x)$ as
a formal power series and frequently ignore issues of convergence.

It is customary to refer to $F(x)$ as the \textit{generating function}
of the sequence $\sigma$.  As we have already remarked, we are not
necessarily interested in calculating $F(x)$ for specific values of
$x$.  However, by convention, we take $F(0)=a_0$.

\begin{example}\label{exam:genfunction:geom-series}
  Consider the constant sequence $\sigma=\{a_n:n\ge0\}$ with $a_n=1$
  for every $n\ge0$.  Then the generating function $F(x)$ of $\sigma$
  is given by
  \[
  F(x)=1+x+x^2+x^3+x^4+x^5+x^6+\cdots.
  \]
  You probably remember that this last expression is the Maclaurin
  series for the function $F(x)=1/(1-x)$ and that the series converges
  when $|x|<1$. Since we want to think in terms of formal power
  series, let's see that we can justify the expression
  \[
  \frac{1}{1-x}=1+x+x^2+x^3+x^4+x^5+x^6+\cdots=\sum_{n=0}^\infty x^n
  \]
  without any calculus techniques. Consider the product
  \[(1-x)(1+x+x^2+x^3+x^4+x^5+x^6+\cdots)\] and notice that, since we
  multiply formal power series just like we multiply polynomials
  (power series are pretty much polynomials that go on forever), we
  have that this product is
  \[(1+x+x^2+x^3+x^4+x^5+x^6+\cdots)-x(1+x+x^2+x^3+x^4+x^5+x^6+\cdots)
  = 1.\]
  Now we have that
  \[(1-x)(1+x+x^2+x^3+x^4+x^5+x^6+\cdots) = 1,\]
  or, more usefully, after dividing through by $1-x$,
  \[\frac{1}{1-x} = \sum_{n=0}^\infty x^n.\]
\end{example}

\begin{example}
  Just like you learned in calculus for Maclaurin series, formal power
  series can be differentiated and integrated
  term by term. The rigorous mathematical framework that underlies
  such operations is not our focus here, so take us at our word that
  this can be done for formal power series without concern about
  issues of convergence.

  To see this in action, consider differentiating the power series of
  the previous example. This gives 
  \[
  \frac{1}{(1-x)^2}=1+2x+3x^2+4x^3+5x^4+6x^5+7x^6+\dots=\sum_{n=1}^\infty nx^{n-1}.
  \]
  Integration of the series represented by $1/(1+x) = 1/(1-(-x))$
  yields (after a bit of algebraic manipulation)
  \[
  \log(1+x)=x-\frac{x^2}{2}+\frac{x^3}{3}-\frac{x^4}{4}+\frac{x^5}{5}-
  \frac{x^6}{6}+\dots=\sum_{n=1}^\infty \frac{x^n}{n}
  \]
\end{example}

% \begin{example}
% The exponential function $e^x$ has the following well-known expansion:
% \[
% e^x=1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+\frac{x^4}{4!}+\dots=
% \sum_{n=0}^\infty \frac{x^n}{n!}.
% \]
% This series converges for all real $x$, as do the familiar
% series for $\sin x$ and $\cos x$:
% \[
% \sin x= \sum_{n=0}^\infty (-1)^{n}\frac{x^{2n+1}}{(2n+1)!}\quad\text{and}
% \cos x= \sum_{n=0}^\infty (-1)^{n}\frac{x^{2n}}{(2n)!}.
% \]
% \end{example}

Before you become convinced that we're only going to concern ourselves
with generating functions that actually converge, let's see that we
can talk about the formal power series
\[
F(x)=\sum_{n=0}^{\infty} n! x^n,
\]
even though it has radius of convergence~$0$, i.e., the series $F(x)$
converges only for $x=0$, so that $F(0)=1$.  Nevertheless, it makes
sense to speak of the formal power series $F(x)$ as the generating
function for the sequence $\{a_n:n\ge0\}$, $a_0=1$ and  $a_n$ is the number
of permutations of $\{1,2,\dots,n\}$ when $n\ge1$.

For reference, we state the following elementary result, which
emphasizes the form of a product of two power series.

\begin{proposition}\label{prop:genfunction-product}
Let $A(x)=\sum_{n=0}^\infty a_nx^n$ and
$B(x)=\sum_{n=0}^\infty b_nx^n$ be generating functions.  Then
$A(x)B(x)$ is the generating function of the sequence whose $n^{th}$ term
is given by
\[
a_0b_n+a_1b_{n-1}+a_2b_{n-2}+\dots+a_nb_0=\sum_{k=0}^n a_kb_{n-k}.
\]
\end{proposition}


\section{Another look at distributing apples or folders}\label{s:genfunction:distributions}

A recurring problem so far in this book has been to consider problems
that ask about distributing indistinguishable objects (say apples) to
distinct entities (say children). We started in \autoref{ch:strings}
by asking how many ways there were to distribute $40$ apples to $5$
children so that each child is guaranteed to get at least one apple
and saw that the answer was $C(39,4)$. We even saw how to restrict the
situation so that one of the children was limited and could receive at
most $10$ apples. In \autoref{ch:inclusion-exclusion}, we learned how
to extend the restrictions so that more than one child had
restrictions on the number of apples allowed by taking advantage of
the Principle of Inclusion-Exclusion. Before moving on to see how
generating functions can allow us to get even more creative with our
restrictions, let's take a moment to see how generating functions
would allow us to solve the most basic problem at hand.

\begin{example}
  We already know that the number of ways to distribute $n$ apples to
  $5$ children so that each child gets at least one apple is
  $C(n-1,4)$, but it will be instructive to see how we can derive this
  result using generating functions. Let's start with an even simpler
  problem: how many ways are there to distribute $n$ apples to
  \textit{one} child so that each child receives at least one apple?
  Well, this isn't too hard, there's only one way to do it---give all
  the apples to the lucky kid! Thus the \textit{sequence} that
  enumerates the number of ways to do this is $\{a_n\colon n\geq 1\}$
  with $a_n=1$ for all $n\geq 1$. Then the generating function for
  this sequence is
  \[x+x^2+x^3+\cdots = x(1+x+x^2+x^3+\cdots) = \frac{x}{1-x}.\]

  How can we get from this fact to the question of five children?
  Notice what happens when we multiply
  \[(x+x^2+\cdots)(x+x^2+\cdots)(x+x^2+\cdots)(x+x^2+\cdots)
  (x+x^2+\cdots).\] To see what this product represents, first
  consider how many ways can we get an $x^6$? We could use the $x^2$
  from the first factor and $x$ from each of the other four, or $x^2$
  from the second factor and $x$ from each of the other four, etc.,
  meaning that the coefficient on $x^6$ is $5 = C(5,4)$. More
  generally, what's the coefficient on $x^n$ in the product? In the
  expansion, we get an $x^n$ for every product of the form
  $x^{k_1}x^{k_2}x^{k_3}x^{k_4}x^{k_5}$ where $k_1+k_2+k_3+k_4+k_5 =
  n$. Returning to the general question here, we're really dealing
  with distributing $n$ apples to $5$ children, and since $k_i> 0$ for
  $i=1,2,\dots,5$, we also have the guarantee that each child receives
  at least one apple, so the product of the generating function for
  \textit{one} child gives the generating function for \textit{five}
  children.

  Let's pretend for a minute that we didn't know that the coefficients
  must be $C(n-1,4)$. How could we figure out the coefficients just
  from the generating function? The generating function we're
  interested in is $x^5/(1-x)^5$, which you should be able to pretty
  quickly see satisfies
  \begin{align*}
    \frac{x^5}{(1-x)^5} &=
  \frac{x^5}{4!}\frac{d^4}{dx^4}\left(\frac{1}{1-x}\right) =
  \frac{x^5}{4!}\sum_{n=0}^\infty n(n-1)(n-2)(n-3)x^{n-4}\\
  & =\sum_{n=0}^\infty \frac{n(n-1)(n-2)(n-3)}{4!}x^{n+1} =
  \sum_{n=0}^\infty \binom{n}{4}x^{n+1}.
  \end{align*}
  The coefficient on $x^n$ in this series $C(n-1,4)$, just as we expected.
\end{example}

We could revisit an example from \autoref{ch:inclusion-exclusion} to
see that if we wanted to limit a child to receive at most $4$ apples,
we would use $(x+x^2+x^3+x^4)$ as its generating function instead of
$x/(1-x)$, but rather than belabor that here, let's try something a
bit more exotic.

\begin{example}
  A grocery store is preparing holiday fruit baskets for sale. Each
  fruit basket will have $20$ pieces of fruit in it, chosen from
  apples, pears, oranges, and grapefruit. How many different ways can
  such a basket be prepared if there must be at least one apple in a
  basket, a basket cannot contain more than three pears, and the
  number of oranges must be a multiple of four?

  In order to get at the number of baskets consisting of $20$ pieces
  of fruit, let's solve the more general problem where each basket has
  $n$ pieces of fruit. Our method is simple: find the generating
  function for how to do this with each type of fruit individually and
  then multiply them. As in the previous example, the product will
  contain the term $x^n$ for every way of assembling a basket of $n$
  pieces of fruit subject to our restrictions. The apple generating
  function is $x/(1-x)$, since we only want positive powers of $x$
  (corresponding to ensuring at least one apple). The generating
  function for pears is $(1+x+x^2+x^3)$, since we can have only zero,
  one, two, or three pears in basket. For oranges we have $1/(1-x^4) =
  1+x^4+x^8+\cdots$, and the unrestricted grapefruit give us a factor
  of $1/(1-x)$. Multiplying, we have
  \[\frac{x}{1-x} (1+x+x^2+x^3) \frac{1}{1-x^4} \frac{1}{1-x} =
  \frac{x}{(1-x)^2(1-x^4)} (1+x+x^2+x^3).\] Now we want to make use of
  the fact that $(1+x+x^2+x^3) =(1-x^4)/(1-x)$ to see that our
  generating function is
  \[\frac{x}{(1-x)^3} = \frac{x}{2}\sum_{n=0}^\infty n(n-1)x^{n-2} =
  \sum_{n=0}^\infty\frac{n(n-1)}{2} x^{n-1} =
  \sum_{n=0}^\infty\binom{n}{2} x^{n-1} =
  \sum_{n=0}^\infty\binom{n+1}{2} x^n.\]
  Thus, there are $C(n+1,2)$ possible fruit baskets containing $n$
  pieces of fruit, meaning that the answer to the question we
  originally asked is $C(21,2) = 210$.
\end{example}

\begin{example}
  Find the number of integer solutions to the equation
  \[x_1 + x_2 + x_3 = n\] ($n\geq 0$ an integer) with $x_1 \geq 0$
  even, $x_2\geq 0$, and $0\leq x_3\leq 2$.

  Again, we want to look at the generating function we would have if
  each variable existed individually and take their product. For
  $x_1$, we get a factor of $1/(1-x^2)$; for $x_2$, we have $1/(1-x)$;
  and for $x_3$ our factor is $(1+x+x^2)$. Therefore, the generating
  function for the number of solutions to the equation above is
  \[\frac{1+x+x^2}{(1-x)(1-x^2)} = \frac{1+x+x^2}{(1+x)(1-x)^2}.\]
  In calculus, when we wanted to integrate a rational function of this
  form, we would use the method of partial fractions to write it as a
  sum of ``simpler'' rational functions whose antiderivatives we
  recognized. Here, our technique is the same, as we can readily
  recognize the formal power series for many rational functions. Our
  goal is to write
  \[\frac{1+x+x^2}{(1+x)(1-x)^2} = \frac{A}{1+x} + \frac{B}{1-x} +
  \frac{C}{(1-x)^2}\]
  for appropriate constants, $A$, $B$, and $C$. To find the constants,
  we clear the denominators, giving
  \[1+x+x^2 = A(1-x)^2 + B(1-x^2) + C(1+x).\]
  Equating coefficients on terms of equal degree, we have:
  \begin{align*}
    1 &= A+B+C\\
    1 &= -2A + C\\
    1 &= A - B
  \end{align*}
  Solving the system, we find $A=1/4$, $B=-3/4$, and
  $C=3/2$. Therefore, our generating function is 
  \[\frac{1}{4}\frac{1}{1+x} -\frac{3}{4} \frac{1}{1-x} +\frac{3}{2}
  \frac{1}{(1-x)^2} = \frac{1}{4}\sum_{n=0}^\infty (-1)^n x^n -
  \frac{3}{4} \sum_{n=0}^\infty x^n + \frac{3}{2}\sum_{n=0}^\infty n
  x^{n-1}.\]
  The solution to our question is thus the coefficient on $x^n$ in the
  above generating function, which is
  \[\frac{(-1)^n}{4} - \frac{3}{4} + \frac{3(n+1)}{2},\]
  a surprising answer that would not be too easy to come up with via
  other methods!
\end{example}

\section{Newton's Binomial Theorem}\label{s:genfunction:gen-bin-thm}

In \autoref{ch:strings}, we discussed the binomial theorem and saw
that the following formula holds for all integers $p\ge1$:
\[
(1+x)^p =\sum_{n=0}^{p}\binom{p}{n} x^n.
\]
You should quickly realize that this formula implies that the
generating function for the number of $n$-element subsets of a
$p$-element set is $(1+x)^p$. The topic of generating functions is
what leads us to consider what happens if we encounter $(1+x)^p$ as a
generating function with $p$ not a positive integer. It turns out
that, by suitably extending the definition of the binomial
coefficients to real numbers, we can also extend the binomial theorem
in a manner originally discovered by Sir Isaac Newton.

We've seen several expressions that can be used to calculate the
binomial coefficients, but in order to extend $C(p,k)$ to real values
of $p$, we will utilize the form
\[
\binom{p}{k}=\frac{P(p,k)}{k!},
\]
recalling that we've defined $P(p,k)$ recursively as $P(p,0)=1$ for
all integers $p\geq 0$ and $P(p,k)=p P(p-1,k-1)$ when $p\geq k > 0$
($k$ an integer). Notice here, however, that the expression for
$P(p,k)$ makes sense for any real number $p$, so long as $k$ is
a non-negative integer.  We make this definition formal.

\begin{definition}
  For all real numbers $p$ and nonnegative integers $k$, the number
  $P(p,k)$ is defined by
  \begin{enumerate}
  \item $P(p,0)=1$ for all real numbers $p$ and
  \item $P(p,k) = p P(p-1,k-1)$ for all real numbers $p$ and integers $k>0$.
  \end{enumerate}
\end{definition}

(Notice that this definition does not require $p\geq k$ as we did with
integers.)

We are now prepared to extend the definition of binomial coefficient
so that $C(p,k)$ is defined for all real $p$ and nonnegative integer
values of $k$. We do this as follows.

\begin{definition}
  For all real numbers $p$ and nonnegative integers $k$,
  \[
  \binom{p}{k}=\frac{P(p,k)}{k!}.
  \]
\end{definition}

Note that $P(p,k)=C(p,k)= 0$ when $p$ and $k$ are integers with
$0\le p<k$.  On the other hand, we have some interesting new concepts
such as $P(-5,4)=(-5)(-6)(-7)(-8)$ and
\[
\binom{-7/2}{5}=\frac{(-7/2)(-9/2)(-11/2)(-13/2)(-15/2)}{5!}.
\]

With this more general definition of binomial coefficients in hand,
we're ready to state Newton's Binomial Theorem for all non-zero real
numbers. The proof of this theorem can be found in most advanced
calculus books.
\begin{theorem}\label{thm:newton-binomial}
For all real $p$ with $p\neq0$,
\[
(1+x)^p=\sum_{n=0}^\infty\binom{p}{n}x^n.
\]
\end{theorem}
Note that the general form reduces to the original version
of the binomial theorem when $p$ is a positive integer.

\section{An Application of the Binomial Theorem}\label{s:genfunction:binom-app}

In this section, we see how \hyperref[thm:newton-binomial]{Newton's
  Binomial Theorem} can be used to derive another useful identity. We
begin by establishing a different recursive formula for $P(p,k)$ than
was used in our definition of it.

\begin{lemma}
For each $k\ge0$,
$P(p,k+1)=P(p,k)(p-k)$.
\end{lemma}
\begin{proof}
When $k=0$, both sides evaluate to $p$.  Now assume validity when
$k=m$ for some non-negative integer $m$.  Then
\begin{align*}
P(p,m+2)&=pP(p-1,m+1)\\
        &= p[P(p-1,m)(p-1-m)]\\
        &=[pP(p-1,m)](p-1-m)\\
        &=P(p,m+1)[p-(m+1)].
\end{align*}
\end{proof}

Our goal in this section will be to invoke
\hyperref[thm:newton-binomial]{Newton's Binomial Theorem} with the
exponent $p=-1/2$. To do so in a meaningful manner, we need a
simplified expression for $C(-1/2,k)$, which the next lemma provides.

\begin{lemma}\label{l:newbinom}
For each $k\ge0$,
$\displaystyle\binom{-1/2}{k}=(-1)^k\frac{\binom{2k}{k}}{2^{2k}}$.
\end{lemma}
\begin{proof}
We proceed by induction on $k$.  Both sides reduce to $1$ when
$k=0$.  Now assume validity when $k=m$ for some non-negative
integer $m$.  Then

\begin{align*}
\binom{-1/2}{m+1} &=\frac{P(-1/2,m+1)}{(m+1)!}
                  =\frac{P(-1/2,m)(-1/2-m)}{(m+1)m!}\\
                  &=\frac{-1/2-m}{m+1}\binom{-1/2}{m}
                  =(-1)\frac{2m+1}{2(m+1)}(-1)^m\frac{\binom{2m}{m}}{2^{2m}}\\
                  &=(-1)^{m+1}\frac{1}{2^{2m}}\frac{(2m+2)(2m+1)}{(2m+2)2(m+1)}\binom{2m}{m}=
                  (-1)^{m+1}\frac{\binom{2m+2}{m+2}}{2^{2m+2}}.
\end{align*}
\end{proof}

\begin{theorem}\label{t:sqrt}
  The function $f(x)=(1-4x)^{-1/2}$ is the generating function of the
  sequence $\{\binom{2n}{n}:n\ge0\}$.
\end{theorem}

\begin{proof}
  By \hyperref[thm:newton-binomial]{Newton's Binomial Theorem} and
  \hyperref[l:newbinom]{Lemma~\ref*{l:newbinom}}, we know that
\begin{align*}
(1-4x)^{-1/2}&=\sum_{n=0}^\infty\binom{-1/2}{n}(-4x)^n\\
             &=\sum_{n=0}^\infty(-1)^n2^{2n}\binom{-1/2}{n}x^n\\
             &=\sum_{n=0}^\infty \binom{2n}{n}x^n.
\end{align*}
\end{proof}

Now recalling
\hyperref[prop:genfunction-product]{Proposition~\ref*{prop:genfunction-product}}
about the coefficients in the product of two generating functions, we
are able to deduce the following corollary of \autoref{t:sqrt} by
squaring the function $f(x) = (1-4x)^{-1/2}$.

\begin{corollary}
For all $n\ge0$,
\[
2^{2n}=\sum_{k=0}^n\binom{2k}{k}\binom{2n-2k}{k}.
\]
\end{corollary}



\section{Partitions of an Integer}\label{s:genfunction:partitions-integer}

A recurring theme in this course has been to count the number of
integer solutions to an equation of the form $x_1+x_2+\cdots + x_k = n$. What
if we wanted to count the number of such solutions but didn't care
what $k$ was? How about if we took this new question and required that
the $x_i$ be \emph{distinct} (i.e., $x_i\neq x_j$ for $i\neq j$)? What
about if we required that each $x_i$ be odd? These certainly don't
seem like easy questions to answer at first, but generating functions
will allow us to say something very interesting about the answers to
the last two questions.

By a \emph{partition} $P$ of an integer, we mean a collection of (not
necessarily distinct) positive integers such that $\sum_{i\in P} i =
n$. (By convention, we will write the elements of $P$ from largest to
smallest.) For example, $2+2+1$ is a partition of $5$. For each
$n\ge0$, let $p_n$ denote the number of partitions of the integer $n$
(with $p_0=1$ by convention).  Note that $p_8=22$ as evidenced by the
list in \autoref{fig:genfunction:partsof8}.
\begin{figure}[hb]
%\centering
% \begin{multicols}{3}
%   8\quad\text{distinct}\\
%   7+1\quad\text{distinct and odd}\\
%   6+2\quad\text{distinct}\\
%   6+1+1\\
%   5+3\quad\text{distinct and odd}\\
%   5+2+1\quad\text{distinct}\\
%   5+1+1+1\quad\text{odd}\\
%   4+4\\
%   4+3+1\quad\text{distinct}\\
%   4+2+2\\
%   4+2+1+1\\
%   4+1+1+1+1\\
%   3+3+2\\
%   3+3+1+1\quad\text{odd}\\
%   3+2+2+1\\
%   3+2+1+1+1\\
%   3+1+1+1+1+1\quad\text{odd}\\
%   2+2+2+2\\
%   2+2+2+1+1\\
%   2+2+1+1+1+1\\
%   2+1+1+1+1+1+1\\
%   1+1+1+1+1+1+1+1\quad\text{odd}  
% \end{multicols}
\begin{tabular}{lll}
  8\quad\text{distinct parts}&
  7+1\quad\text{distinct parts, odd parts}&
  6+2\quad\text{distinct parts}\\
  6+1+1&
  5+3\quad\text{distinct parts, odd parts}&
  5+2+1\quad\text{distinct parts}\\
  5+1+1+1\quad\text{odd parts}&
  4+4&
  4+3+1\quad\text{distinct parts}\\
  4+2+2&
  4+2+1+1&
  4+1+1+1+1\\
  3+3+2&
  3+3+1+1\quad\text{odd parts}&
  3+2+2+1\\
  3+2+1+1+1&
  3+1+1+1+1+1\quad\text{odd parts}&
  2+2+2+2\\
  2+2+2+1+1&
  2+2+1+1+1+1&
  2+1+1+1+1+1+1\\&
  1+1+1+1+1+1+1+1\quad\text{odd parts}
\end{tabular}
\caption{The partitions of $8$, noting those into distinct parts
  and those into odd parts.}
\label{fig:genfunction:partsof8}
\end{figure}
Note that there are $6$ partitions of $8$ into \textit{distinct} parts. Also
there are $6$ partitions of $8$ into \textit{odd} parts. While it
might seem that this is a coincidence, it in fact is always the case
as the following theorem states.

\begin{theorem}\label{thm:partition}
For each $n\ge1$, the number of partitions of $n$ into distinct parts is
equal to the number of partitions of $n$ into odd parts.
\end{theorem}

\begin{proof}
The generating function $D(x)$ for
the number of partitions of $n$ into distinct parts is
\[
D(x)=\prod_{n=1}^\infty (1+x^n).
\]
On the other hand, the generating function $O(x)$ for the number of partitions
of $n$ into odd parts is
\[
O(x)=\prod_{n=1}^\infty\frac{1}{1-x^{2n-1}}.
\]
To see that $D(x)=O(x)$, we
note that $1-x^{2n}=(1-x^n)(1+x^n)$ for all $n\ge1$.  Therefore,
\begin{align*}
D(x)&=\prod_{n=1}^\infty
(1+x^n)=\prod_{n=1}^\infty\frac{1-x^{2n}}{1-x^n} =\frac{\prod_{n=1}^\infty(1-x^{2n})}{\prod_{n=1}^\infty(1-x^n)}\\
    &=\frac{\prod_{n=1}^\infty(1-x^{2n})}{
       \prod_{n=1}^\infty(1-x^{2n-1})\prod_{n=1}^\infty(1-x^{2n})}
    =\prod_{n=1}^\infty\frac{1}{1-x^{2n-1}}\\
    &= O(x).
\end{align*}
\end{proof}

\section{Exponential generating functions}\label{s:genfunction:exponential}

If we had wanted to be absolutely precise earlier in the chapter, we
would have referred to the generating functions we studied as
\emph{ordinary generating functions} or even \emph{ordinary power
  series generating functions}. This is because there are other types
of generating functions, based on other types of power series. In this
section, we briefly introduce another type of generating function, the
\emph{exponential generating function}. While an ordinary generating
function has the form $\sum_{n} a_n x^n$, an exponential generating
function is based on the power series for the exponential function
$e^x$. Thus, the exponential generating function for the sequence
$\{a_n\colon n\geq 0\}$ is $\sum_n a_n x^n/n!$. In this section, we
will see some ways we can use exponential generating functions to
solve problems that we could not tackle with ordinary generating
functions. However, we will only scratch the surface of the potential
of this type of generating function. We begin with the most
fundamental exponential generating function, in analogy with the
ordinary generating function $1/(1-x)$ of
\hyperref[exam:genfunction:geom-series]{Example~\ref*{exam:genfunction:geom-series}}.

\begin{example}
  Consider the constant sequence $1, 1, 1, 1, \dots$. Then the
  exponential generating function for this sequence is 
  \[E(x) = \sum_{n=0}^\infty \frac{x^n}{n!}.\]
  From calculus, you probably recall that this is the power series for
  the exponential function $e^x$, which is why we call this type of
  generating function an exponential generating function. From this
  example, we can quickly recognize that the exponential generating
  function for the number of binary strings of length $n$ is $e^{2x}$
  since
  \[e^{2x} = \sum_{n=0}^\infty \frac{(2x)^n}{n!} = \sum_{n=0}^\infty
  2^n\frac{x^n}{n!}.\]
\end{example}

In our study of ordinary generating functions earlier in this chapter,
we considered examples where quantity (number of apples, etc.)
mattered but order did not. One of the areas where exponential
generating functions are preferable to ordinary generating functions
is in applications where order matters, such as counting
strings. For instance, although the bit strings $10001$ and $011000$
both contain three zeros and two ones, they are not the same
strings. On the other hand, two fruit baskets containing two apples
and three oranges would be considered equivalent, regardless of how
you arranged the fruit. We now consider a couple of examples to
illustrate this technique.

\begin{example}
  Suppose we wish to find the number of ternary strings in which the
  number of $0$s is even. (There are no restrictions on the number of
  $1$s and $2$s.) As with ordinary generating functions, we determine
  a generating function for each of the digits and multiply them. For
  $1$s and $2$s, since we may have any number of each of them, we
  introduce a factor of $e^x$ for each. For an even number of $0$s,
  we need
  \[1 + \frac{x^2}{2!} + \frac{x^4}{4!} + \frac{x^6}{6!} + \cdots =
  \sum_{n=0}^\infty \frac{x^{2n}}{(2n)!}.\]
  Unlike with ordinary generating functions, we cannot represent this
  series in a more compact form by simply substituting a function of
  $x$ into the series for $e^y$. However, with a small amount of
  cleverness, we are able to achieve the desired result. To do this,
  first notice that
  \[e^{-x} = 1 - x + \frac{x^2}{2!} - \frac{x^3}{3!} + \cdots =
  \sum_{n=0}^\infty \frac{(-1)^nx^n}{n!}.\]
  Thus, when we add the series for $e^{-x}$ to the series for $e^x$
  all of the terms with odd powers of $x$ will cancel! We thus find
  \[e^x+e^{-x} = 2+2\frac{x^2}{2!} + 2\frac{x^4}{4!} + \cdots,\]
  which is exactly twice what we need. Therefore, the factor we introduce
  for $0$s is $(e^x+e^{-x})/2$.

  Now we have an exponential generating function of 
  \[\frac{e^x+e^{-x}}{2}e^x e^x = \frac{e^{3x} + e^x}{2} =
  \frac{1}{2}\left(\sum_{n=0}^\infty \frac{3^nx^n}{n!} +
    \sum_{n=0}^\infty \frac{x^n}{n!}\right).\] To find the number of
  ternary strings in which the number of $0$s is even, we thus need to
  look at the coefficient on $x^n/n!$ in the series expansion. In
  doing this, we find that the number of ternary strings with an even
  number of $0$s is $(3^n+1)/2$.
\end{example}

We can also use exponential generating functions when there are bounds
on the number of times a symbol appears, such as in the following
example.

\begin{example}
  How many ternary strings of length $n$ have at least one $0$ and at
  least one $1$?  To ensure that a symbol appears at least once, we
  need the following exponential generating function
  \[x+\frac{x^2}{2!} + \frac{x^3}{3!} + \cdots = \sum_{n=1}^\infty
  \frac{x^n}{n!}.\] You should notice that this is almost the series
  for $e^x$, except it's missing the first term. Thus,
  $\sum_{n=1}^\infty x^n/n! = e^x-1$. Using this, we now have 
  \[(e^x-1)(e^x-1)e^x=e^{3x}-2e^{2x}+e^x\] as the exponential
  generating function for this problem.  Finding the series expansion,
  we have
  \[\sum_{n=0}^\infty \frac{3^nx^n}{n!} - 2\sum_{n=0}^\infty
  \frac{2^nx^n}{n!} + \sum_{n=0}^\infty \frac{x^n}{n!}.\]
  Now we can answer the question by reading off the coefficient on
  $x^n/n!$, which is $3^n - 2\cdot 2^n + 1$.
\end{example}

Before proceeding to an additional example, let's take a minute to
look at another way to answer the question from the previous
example. To count the number of ternary strings of length $n$ with at
least one $0$ and at least one $1$, we can count all ternary strings
of length $n$ and use the principle of inclusion-exclusion to
eliminate the undesirable strings lacking a $0$ and/or a $1$. If a
ternary string lacks a $0$, we're counting all strings made up of $1$s
and $2$s, so there are $2^n$ strings. Similarly for lacking a
$1$. However, if we subtract $2\cdot 2^n$, then we've subtracted the
strings that lack both a $0$ \emph{and} a $1$ twice. A ternary string
that has no $0$s and no $1$s consists only of $2$s. There is a single
ternary string of length $n$ satisfying this criterion. Thus, we
obtain $3^n-2\cdot 2^n+1$ in another way.

\begin{example}
  Alice needs to set an eight-digit passcode for her mobile phone. The
  restrictions on the passcode are a little peculiar. Specifically, it
  must contain an even number of $0$s, at least one $1$, and at most
  three $2$s. Bob remarks that although the restrictions are unusual,
  they don't do much to reduce the number of possible passcodes from
  the total number of $10^8$ eight-digit strings. Carlos isn't
  convinced that's the case, so he works up an exponential generating
  function as follows. For the seven digits on which there are no
  restrictions, a factor of $e^{7x}$ is introduced. To account for an
  even number of $0$s, he uses $(e^x+e^{-x})/2$. For at least one
  $1$, a factor of $e^x-1$ is required. Finally, $1+x+x^2/2!+x^3/3!$
  accounts for the restriction of at most three $2$s. The exponential
  generating function for the number of $n$-digit passcodes is thus
  \[e^{7x}\frac{e^x+e^{-x}}{2}(e^x-1)\left(1+x+\frac{x^2}{2!} +
    \frac{x^3}{3!}\right).\]
  
  Dave sees this mess written on the whiteboard and groans. He figures
  they'll be there all day multiplying and making algebra mistakes in
  trying to find the desired coefficient. Alice points out that they
  don't really need to find the coefficient on $x^n/n!$ for all
  $n$. Instead, she suggests they use a computer algebra system to
  just find the coefficient on $x^8/8!$. After doing this, they find
  that there are $33847837$ valid passcodes for the mobile phone. A
  quick calculation shows that Bob was totally off base in claiming
  that there was no significant reduction in the number of possible
  strings to use as a passcode. The total number of valid passcodes is
  only $33.85\%$ of the total number of eight-digit strings!
\end{example}

Exponential generating functions are useful in many other situations
beyond enumerating strings. For instance, they can be used to count
the number of $n$-vertex, connected, labeled graphs. However, doing so
is beyond the scope of this book. If you are interested in learning
much more about generating functions, the book
\emph{generatingfunctionology} by Herbert S. Wilf is available online
at \url{http://www.math.upenn.edu/~wilf/DownldGF.html}.

\section{Discussion}\label{s:genfunction:discussion}

Yolanda was beside herself ``Do you guys realize what we just
did?  We showed that two quantities were equal without saying
anything about what those quantities actually were.  That's really
neat.''  Nobody said anything for a long time, but after some time
Dave said ``There might be other instances where you would
want to be able to communicate fully, yet hold back on every
last detail.''  Bob said ``I don't get it.''  Alice interjected
a comment that was more of question than a statement ``Do you
mean that parties may want to communicate, while maintaining
that the conversation did not occur?''  Carlos added ``Or maybe
they just want to be able to detect whether anyone else was
listening.''  Now Zori was nearly happy.  Privacy and security were
big ticket items.

\section{Exercises}\label{s:genfunction:exercises}

Computer algebra systems can be powerful tools for working with
generating functions. In addition to stand-alone applications that run
on your computer, the free website Wolfram$|$Alpha
(\url{http://www.wolframalpha.com}) is capable of finding general
forms of some power series representations and specific coefficients
for many more. However, unless an exercise specifically suggests that
you use a computer algebra system, we strongly encourage you to solve
the problem by hand. This will help you develop a better understanding
of how generating functions can be used.

For all exercises in this section, ``generating function'' should be
taken to mean ``ordinary generating function.'' Exponential generating
functions are only required in exercises specifically mentioning them.

\begin{enumerate}
\item For each \emph{finite} sequence below, give its 
  generating function.
  \begin{multicols}{3}
    \begin{enumerate}
    \item $1, 4, 6, 4, 1$
    \item $1,1,1,1,1,0,0,1$
    \item $0,0,0,1,2,3,4,5$
    \item $1,1,1,1,1,1,1$
    \item $3,0,0,1,-4,7$
    \item $0,0,0,0,1,2,-3,0,1$
    \end{enumerate}
  \end{multicols}
\item For each \emph{infinite} sequence suggested below, give its
   generating function in closed form, i.e., \emph{not} as an
  infinite sum. (Use the most obvious choice of form for the general
  term of each sequence.)
  \begin{multicols}{2}
    \begin{enumerate}
    \item $0,1,1,1,1,1,\dots$
    \item $1,0,0,1,0,0,1,0,0,1,0,0,1,\dots$
    \item $1,2,4,8,16,32,\dots$
    \item $0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,\dots$
    \item $1,-1,1,-1,1,-1,1,-1,1,-1,\dots$
    \item $\displaystyle 2^8,2^7\binom{8}{1}, 2^6\binom{8}{2},\dots,\binom{8}{8},0,0,0,\dots$
    \item $1,1,1,0,0,1,1,1,1,1,1,1,1,1,\dots$
    \item $0,0,0,1,2,3,4,5,6,\dots$
    \item $3,2,4,1,1,1,1,1,1,\dots$
    \item $0,2,0,0,2,0,0,2,0,0,2,0,0,2,\dots$
    \item $6,0,-6,0,6,0,-6,0,6,\dots$
    \item $\displaystyle 1,3,6,10,15,\dots,\binom{n+2}{2},\dots$
  \end{enumerate}
  \end{multicols}
\item For each generating function below, give a closed form
  for the $n^{\text{th}}$ term of its associated sequence.
  \begin{enumerate}
    \begin{multicols}{3}
    \item $(1+x)^{10}$
    \item $\displaystyle \frac{1}{1-x^4}$
    \item $\displaystyle \frac{x^3}{1-x^4}$
    \item $\displaystyle \frac{1-x^4}{1-x}$
    \item $\displaystyle \frac{1+x^2-x^4}{1-x}$
    \item $\displaystyle \frac{1}{1-4x}$
    \item $\displaystyle \frac{1}{1+4x}$
    \item $\displaystyle \frac{x^5}{(1-x)^4}$
    \item $\displaystyle \frac{x^2+x+1}{1-x^7}$
    \end{multicols}
 \item $\displaystyle 3x^4 + 7x^3 -x^2 + 10 + \frac{1}{1-x^3}$
  \end{enumerate}
\item Find the coefficient on $x^{10}$ in each of the generating
  functions below.
   \begin{enumerate}
   \item $(x^3+x^5+x^6)(x^4+x^5+x^7) (1+x^5+x^{10}+x^{15}+\cdots)$
   \item $(1+x^3) (x^3+x^4+x^5+\cdots)(x^4+x^5+x^6+x^7+x^8+\cdots)$
     \begin{multicols}{3}
     \item $(1+x)^{12}$
     \item $\displaystyle\frac{x^5}{1-3x^5}$
     \item $\displaystyle\frac{1}{(1-x)^3}$
     \item $\displaystyle\frac{1}{1-5x^4}$
     \item $\displaystyle\frac{x}{1-2x^3}$
     \item $\displaystyle\frac{1-x^{14}}{1-x}$
     \end{multicols}
   \end{enumerate}
 \item Find the generating function for the number of ways to
   create a bunch of $n$ balloons selected from white, gold, and blue
   balloons so that the bunch contains at least one white balloon, at
   least one gold balloon, and at most two blue balloons. How many
   ways are there to create a bunch of $10$ balloons subject to these
   requirements? 
 \item A volunteer coordinator has $30$ identical chocolate chip
   cookies to distribute to six volunteers. Use a generating function
   (and computer algebra system) to determine the number of ways she
   can distribute the cookies so that each volunteer receives at least
   two cookies and no more than seven cookies.
 \item Consider the inequality
   \[x_1+x_2+x_3+x_4\leq n\] where $x_1,x_2,x_3,x_4,n\geq 0$ are all
   integers. Suppose also that $x_2\geq 2$, $x_3$ is a multiple of
   $4$, and $1\leq x_4\leq 3$. Let $c_n$ be the number of solutions of
   the inequality subject to these restrictions. Find the generating
   function for the sequence $\{c_n\colon n\geq 0\}$ and use it to
   find a closed formula for $c_n$.
 \item Find the generating function for the number of ways to
   distribute blank scratch paper to Alice, Bob, Carlos, and Dave so
   that Alice gets at least two sheets, Bob gets at most three sheets,
   the number of sheets Carlos receives is a multiple of three, and
   Dave gets at least one sheet but no more than six sheets of scratch
   paper. Without finding the power series expansion for this
   generating function (or using a computer algebra system!),
   determine the coefficients on $x^2$ and $x^3$ in this generating
   function.
 \item What is the generating function for the number of ways
   to select a group of $n$ students from a class of $p$ students?
 \item Using generating functions, find a formula for the
   number of different types of fruit baskets containing of $n$ pieces
   of fruit chosen from pomegranates, bananas, apples, oranges, pears,
   and figs that can be made subject to the following restrictions:
  \begin{itemize}
  \item there are either $0$ or $2$ pomegranates,
  \item there is at least $1$ banana,
  \item the number of figs is a multiple of $5$,
  \item there are at most $4$ pears, and
  \item there are no restrictions on the number of apples or oranges.
  \end{itemize}
  How many ways are there to form such a fruit basket with $n=25$ pieces of
  fruit?
\item Using generating functions, find the number of ways to make
  change for a \$$100$ bill using only dollar coins and \$$1$, \$$2$,
  and \$$5$ bills. (\emph{Hint}: Find the partial fractions expansion
  for your generating function. Once you have it, you may find the
  following identity helpful
  \[\frac{p(x)}{1+x+x^2+\cdots + x^k} = \frac{p(x)(1-x)}{1-x^{k+1}},\]
  where $p(x)$ will be a polynomial in this instance.)
\item A businesswoman is traveling in Belgium and wants to
  buy chocolates for herself, her husband, and their two daughters. A
  store has dark chocolate truffles (\EURdig\thinspace 10/box), milk
  chocolate truffles (\EURdig\thinspace 8/box), nougat-filled
  chocolates (\EURdig\thinspace 5/box), milk chocolate bars
  (\EURdig\thinspace 7/bar), and 75\% cacao chocolate bars
  (\EURdig\thinspace 11/bar). Her purchase is to be subject to the
  following:
  \begin{itemize}
  \item Only the daughters like dark chocolate truffles, and her
    purchase must ensure that each daughter gets an equal number of
    boxes of them (if they get any).
  \item At least two boxes of milk chocolate truffles must be
    purchased.
  \item If she buys any boxes of nougat-filled chocolates, then she
    buys exactly enough that each family member gets precisely one
    box of them.
  \item At most three milk chocolate bars may be purchased.
  \item There are no restrictions on the number of 75\% cacao
    chocolate bars.
  \end{itemize}
  Let $s_n$ be the number of ways the businesswoman can spend exactly
  \EURdig\thinspace $n$ (\textbf{not} buy $n$ items!) at this
  chocolate shop. Find the generating function for the sequence
  $\{s_n\colon n\geq 0\}$. In how many ways can she spend exactly
  \EURdig\thinspace 100 at the chocolate shop? (A computer algebra
  system will be helpful for finding coefficients.)
\item Bags of candy are being prepared to distribute to the children
  at a school. The types of candy available are chocolate bites,
  peanut butter cups, peppermint candies, and fruit chews. Each bag
  must contain at least two chocolate bites, an even number of peanut
  butter cups, and at most six peppermint candies. The fruit chews are
  available in four different flavors---lemon, orange, strawberry, and
  cherry. A bag of candy may contain at most two fruit chews, which
  may be of the same or different flavors. Beyond the number of pieces
  of each type of candy included, bags of candy are distinguished by
  using the flavors of the fruit chews included, not just the
  number. For example, a bag containing two orange fruit chews is
  different from a bag containing a cherry fruit chew and a strawberry
  fruit chew, even if the number of pieces of each other type of candy
  is the same. 
  \begin{enumerate}
  \item Let $b_n$ be the number of different bags of candy with $n$
    pieces of candy that can be formed subject to these restrictions.
    Find the generating function for the sequence $\{b_n\colon n\geq
    0\}$.
    % Fruit chews factor is 1+4x+10x^2. This actually has a nice
    % partial fractions decomposition and could easily become a
    % request to find a formula for b_n, too.
  \item Suppose the school has $400$ students and the teachers would
    like to ensure that each student gets a different bag of
    candy. However, they know there will be fights if the bags do not
    all contain the same number of pieces of candy. What is the
    smallest number of pieces of candy they can include in the bags
    that ensures each student gets a different bag of candy containing
    the same number of pieces of candy?
  \end{enumerate}
\item Make up a combinatorial problem (similar to those found in this
  chapter) that leads to the generating function
  \[\frac{(1+x^2+x^4)x^2}{(1-x)^3(1-x^3)(1-x^{10})}.\]
\item Tollbooths in Illinois accept all U.S. coins, including
  pennies. Carlos has a very large supply of pennies, nickels,
  dimes, and quarters in his car as he drives on a tollway. He
  encounters a toll for \$$0.95$ and wonders how many different
  ways he could use his supply of coins to pay the toll without
  getting change back. 
  \begin{enumerate}
  \item Use a generating function and computer algebra system to
    determine the number of ways Carlos could pay his \$$0.95$ toll by
    dropping the coins together into the toll bin. (Assume coins of
    the same denomination cannot be distinguished from each other.)
  \item Suppose that instead of having a bin into which motorists drop
    the coins to pay their toll, the coins must be inserted one-by-one
    into a coin slot. In this scenario, Carlos wonders how many ways
    he could pay the \$$0.95$ toll when the order the coins are
    inserted matters. For instance, in the previous part, the use of
    three quarters and two dimes would be counted only one
    time. However, when the coins must be inserted individually into a
    slot, there are $10=C(5,2)$ ways to insert this combination. Use
    an ordinary generating function and computer algebra system to
    determine the number of ways that Carlos could pay the \$$0.95$
    toll when considering the order the coins are inserted.
   % This second part is currently rather challenging, since there's
    % no example like it in the text or other exercise like it.
 \end{enumerate}
\item List the partitions of $9$. Write a D next to each partition
  into distinct parts and an O next to each partition into odd parts.
\item Use generating functions to find the number of ways to
  partition $10$ into odd parts.
\item What is the smallest integer that can be partitioned in at least
  $1000$ ways? How many ways can it be partitioned? How many of them
  are into distinct parts? (A computer algebra system will be helpful
  for this exercise.)
\item What is the generating function for the number of
  partitions of an integer into even parts?
\item Find the exponential generating function (in closed form, not as
  an infinite sum) for each infinite sequence $\{a_n\colon n\geq 0\}$
  whose general term is given below.
  \begin{multicols}{3}
    \begin{enumerate}
    \item $a_n = 5^n$
    \item $a_n = (-1)^n2^n$
    \item $a_n = 3^{n+2}$
    \item $a_n = n!$
    \item $a_n = n$
    \item $a_n = 1/(n+1)$
    \end{enumerate}
  \end{multicols}
\item For each exponential generating function below, give a formula
  in closed form for the sequence $\{a_n\colon n\geq 0\}$ it
  represents.
  \begin{multicols}{4}
    \begin{enumerate}
    \item $e^{7x}$
    \item $x^2 e^{3x}$ % 3^{n-2}n(n-1)
    \item $\displaystyle \frac{1}{1+x}$
    \item $e^{x^4}$
    \end{enumerate}
  \end{multicols}
\item Find the coefficient on $x^{10}/{10!}$ in each of the
  exponential generating functions below.
  \begin{multicols}{3}
    \begin{enumerate}
    \item $e^{3x}$
    \item $\displaystyle\frac{e^x-e^{-x}}{2}$
    \item $\displaystyle\frac{e^x+e^{-x}}{2}$
    \item $xe^{3x}-x^2$
    \item $\displaystyle\frac{1}{1-2x}$
    \item $e^{x^2}$
    \end{enumerate}
  \end{multicols}
\item Find the exponential generating function for the number of
  strings of length $n$ formed from the set $\{a,b,c,d\}$ if there
  must be at least one $a$ and the number of $c$'s must be even. Find
  a closed formula for the coefficients of this exponential generating
  function.
\item Find the exponential generating function for the number of
  strings of length $n$ formed from the set $\{a,b,c,d\}$ if there
  must be at least one $a$ and the number of $c$'s must be odd. Find a
  closed formula for the coefficients of this exponential generating
  function.
\item Find the exponential generating function for the number of
  strings of length $n$ formed from the set $\{a,b,c,d\}$ if there
  must be at least one $a$, the number of $b$'s must be odd, and the
  number of $d$'s is either $1$ or $2$. Find a closed formula for the
  coefficients of this exponential generating function.
\item Find the exponential generating function for the number of
  alphanumeric strings of length $n$ formed from the $26$ uppercase
  letters of the English alphabet and $10$ decimal digits if
  \begin{itemize}
  \item each vowel must appear at least one time;
  \item the letter $T$ must appear at least three times;
  \item the letter $Z$ may appear at most three times;
  \item each even digit must appear an even number of times; and
  \item each odd digit must appear an odd number of times.
  \end{itemize}

\end{enumerate}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "chap-skel-mtk"
%%% End: 
